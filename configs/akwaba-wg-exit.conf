[Interface]
# Akwaba (Director Node) WireGuard Configuration
# Replace <akwaba-private-key> with the actual private key from /etc/wireguard/akwaba-private.key

PrivateKey = <akwaba-private-key>
Address = 172.16.99.2/30
ListenPort = 51820
MTU = 1340
Table = off

# Forward traffic from Oracle through Tailscale exit node
PostUp = iptables -t nat -A POSTROUTING -o tailscale0 -j MASQUERADE
PostUp = iptables -A FORWARD -i wg-exit -o tailscale0 -j ACCEPT
PostUp = iptables -A FORWARD -i tailscale0 -o wg-exit -j ACCEPT
PostUp = iptables -A INPUT -i wg-exit -j ACCEPT
PostUp = iptables -A OUTPUT -o wg-exit -j ACCEPT
PostUp = sysctl -w net.ipv4.ip_forward=1

# Cleanup on shutdown
PostDown = iptables -t nat -D POSTROUTING -o tailscale0 -j MASQUERADE
PostDown = iptables -D FORWARD -i wg-exit -o tailscale0 -j ACCEPT
PostDown = iptables -D FORWARD -i tailscale0 -o wg-exit -j ACCEPT
PostDown = iptables -D INPUT -i wg-exit -j ACCEPT
PostDown = iptables -D OUTPUT -o wg-exit -j ACCEPT

[Peer]
# Oracle (Gateway Node)
# Replace <oracle-public-key> with the public key from Oracle's /etc/wireguard/oracle-public.key
PublicKey = <oracle-public-key>

# Accept traffic from Oracle and Tailscale CGNAT range
AllowedIPs = 172.16.99.1/32, 100.64.0.0/10

# Keep connection alive
PersistentKeepalive = 25

# Note: No Endpoint specified - Oracle initiates the connection to us